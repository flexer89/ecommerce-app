prometheus:
  prometheusSpec:
    scrapeInterval: 30s  # Increase the scrapeInterval to ensure scrapeTimeout fits
    evaluationInterval: 30s
    podMonitorSelectorNilUsesHelmValues: false
    serviceMonitorSelectorNilUsesHelmValues: false
    additionalScrapeConfigs:
      - job_name: 'products'
        scrape_interval: 30s  # Align scrape_interval with prometheusSpec
        scrape_timeout: 10s  # Ensure scrape_timeout is less than scrape_interval
        kubernetes_sd_configs:
          - role: service
        relabel_configs:
          - source_labels: [__meta_kubernetes_service_name]
            action: keep
            regex: products-service
      - job_name: 'orders'
        scrape_interval: 30s  # Align scrape_interval with prometheusSpec
        scrape_timeout: 10s  # Ensure scrape_timeout is less than scrape_interval
        kubernetes_sd_configs:
          - role: service
        relabel_configs:
          - source_labels: [__meta_kubernetes_service_name]
            action: keep
            regex: orders-service
      - job_name: 'payments'
        scrape_interval: 30s  # Align scrape_interval with prometheusSpec
        scrape_timeout: 10s  # Ensure scrape_timeout is less than scrape_interval
        kubernetes_sd_configs:
          - role: service
        relabel_configs:
          - source_labels: [__meta_kubernetes_service_name]
            action: keep
            regex: payments-service
      - job_name: 'users'
        scrape_interval: 30s  # Align scrape_interval with prometheusSpec
        scrape_timeout: 10s  # Ensure scrape_timeout is less than scrape_interval
        kubernetes_sd_configs:
          - role: service
        relabel_configs:
          - source_labels: [__meta_kubernetes_service_name]
            action: keep
            regex: users-service
      - job_name: 'carts'
        scrape_interval: 30s  # Align scrape_interval with prometheusSpec
        scrape_timeout: 10s  # Ensure scrape_timeout is less than scrape_interval
        kubernetes_sd_configs:
          - role: service
        relabel_configs:
          - source_labels: [__meta_kubernetes_service_name]
            action: keep
            regex: carts-service
  grafana:
    persistence:
      enabled: true
    dashboardProviders:
      dashboardproviders.yaml:
        apiVersion: 1
        providers:
          - name: 'default'
            orgId: 1
            folder: ''
            type: file
            disableDeletion: false
            editable: true
            options:
              path: /var/lib/grafana/dashboards/default
    dashboards:
      default:
        kong-dash:
          gnetId: 7424
          revision: 11
          datasource: Prometheus
        kic-dash:
          gnetId: 15662
          datasource: Prometheus
    additionalDataSources:
      dashboard1:
        configMapName: fastapi-dashboard-configmap
        file: fastapi-dashboard.json